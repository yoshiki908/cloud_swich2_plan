<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nintendo Switch2 è²¯é‡‘è¨ˆç”»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKã‚’èª­ã¿è¾¼ã¿ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦Firebaseã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¿æŒ
        let db, auth, savingsCollection;
        let userId;

        // Firebaseã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆCanvasç’°å¢ƒã‹ã‚‰æä¾›ã•ã‚Œã‚‹ï¼‰
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç®¡ç†
        let appReady = false;

        // åˆæœŸåŒ–å‡¦ç†
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // èªè¨¼çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ç›£è¦–
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        // å®¶æ—é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
                        savingsCollection = collection(db, `artifacts/${appId}/public/data/savings`);
                        initializeApp(); // UIã®åˆæœŸåŒ–ã‚’é–‹å§‹
                    } else {
                        // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯è‡ªå‹•ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebaseã®åˆæœŸåŒ–ã¾ãŸã¯èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
            }
        }
        
        // ã“ã“ã‹ã‚‰å…ˆã¯HTMLã®scriptã‚¿ã‚°ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«å‰²ã‚Šå½“ã¦ã‚‹
        window.initializeApp = function() {
            if (appReady) return;
            appReady = true;

            setupSnapshotListener();
            setupViewButtons();
        };

        window.addSavings = async function(id) {
            const input = document.getElementById(id);
            const amount = parseInt(input.value, 10);
            const person = document.getElementById('saverName').value;

            if (isNaN(amount) || amount <= 0) {
                showNotification('æœ‰åŠ¹ãªé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            const source = (id === 'dailySavings') ? 'ç©ç«‹è²¯é‡‘' : 'ãŠæ‰‹ä¼ã„å ±å¥¨';
            const newItem = {
                type: id,
                source: source,
                amount: amount,
                person: person,
                date: new Date().toISOString()
            };
            
            try {
                await addDoc(savingsCollection, newItem);
                input.value = '';
                showNotification('è²¯é‡‘ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼', 'success');
            } catch (e) {
                console.error("è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ", e);
                showNotification('è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        };
        
        window.addExtraSavings = async function() {
            const source = document.getElementById('extraSource').value;
            const input = document.getElementById('extraSavings');
            const amount = parseInt(input.value, 10);
            const person = document.getElementById('saverName').value;

            if (isNaN(amount) || amount <= 0) {
                showNotification('æœ‰åŠ¹ãªé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }
            
            let sourceName;
            switch (source) {
                case 'mercari': sourceName = 'ãƒ¡ãƒ«ã‚«ãƒªå£²ä¸Š'; break;
                case 'foodSavings': sourceName = 'å¤§äººã®é£Ÿè²»ç¯€ç´„'; break;
                case 'christmas': sourceName = 'ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ'; break;
                case 'other': sourceName = 'ãã®ä»–'; break;
            }
            
            const newItem = {
                type: source,
                source: sourceName,
                amount: amount,
                person: person,
                date: new Date().toISOString()
            };
            
            try {
                await addDoc(savingsCollection, newItem);
                input.value = '';
                showNotification('è¨˜éŒ²ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼', 'success');
            } catch (e) {
                console.error("è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ", e);
                showNotification('è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        };

        window.deleteEntry = async function(id) {
            if (window.confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    await deleteDoc(doc(db, `artifacts/${appId}/public/data/savings`, id));
                    showNotification('è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚', 'success');
                } catch (e) {
                    console.error("è¨˜éŒ²ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ", e);
                    showNotification('è¨˜éŒ²ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
                }
            }
        };

        window.editEntry = async function(id) {
            const item = window.savingsData.find(item => item.id === id);
            if (!item) return;
            
            const newAmount = parseInt(window.prompt(`é‡‘é¡ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ (${item.amount}å††):`));
            const newPerson = window.prompt(`è²¯é‡‘ã—ãŸäººã‚’ç·¨é›†ã—ã¦ãã ã•ã„ (${item.person}):`, item.person);
            
            if (isNaN(newAmount) || newAmount <= 0 || !newPerson) {
                showNotification('æœ‰åŠ¹ãªé‡‘é¡ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }
            if (newPerson && !SAVER_NAMES.includes(newPerson)) {
                showNotification('æœ‰åŠ¹ãªåå‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, `artifacts/${appId}/public/data/savings`, id), {
                    amount: newAmount,
                    person: newPerson
                });
                showNotification('è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚', 'success');
            } catch (e) {
                console.error("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ", e);
                showNotification('è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        };

        function setupSnapshotListener() {
            onSnapshot(savingsCollection, (querySnapshot) => {
                window.savingsData = [];
                querySnapshot.forEach((doc) => {
                    window.savingsData.push({ id: doc.id, ...doc.data() });
                });
                
                // ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã«ã™ã¹ã¦ã®UIã‚’æ›´æ–°
                window.currentTotal = window.savingsData.reduce((sum, item) => sum + item.amount, 0);
                window.updateDisplay();
                window.renderHistory();
                window.renderChart();
                window.renderIndividualContributions();
            });
        }
        
        initializeFirebase();
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 p-4 min-h-screen flex items-center justify-center">

    <div class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-lg">
        <!-- ã‚¢ãƒ—ãƒªã®ã‚¿ã‚¤ãƒˆãƒ« -->
        <h1 class="text-3xl font-bold text-center mb-6 text-purple-600">
            ã¿ã‚“ãªã§è²¯ã‚ã‚‹ï¼Switch2è²¯é‡‘
        </h1>

        <!-- ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
        <div class="flex justify-center space-x-4 mb-6">
            <button id="viewInputButton" class="bg-purple-500 text-white p-2 px-4 rounded-full font-bold shadow hover:bg-purple-600 transition">æ—¥ã€…ã®è¨˜éŒ²</button>
            <button id="viewGraphButton" class="bg-gray-200 text-gray-700 p-2 px-4 rounded-full font-bold shadow hover:bg-gray-300 transition">ã‚°ãƒ©ãƒ•ã§è¦‹ã‚‹</button>
            <button id="viewContributionButton" class="bg-gray-200 text-gray-700 p-2 px-4 rounded-full font-bold shadow hover:bg-gray-300 transition">å€‹äººåˆ¥è²¢çŒ®åº¦</button>
        </div>
        
        <!-- ãƒˆãƒƒãƒ—ç”»é¢: ç›®æ¨™é‡‘é¡ã¨é€²æ— -->
        <div id="dashboard" class="mb-6 bg-purple-50 p-4 rounded-xl">
            <div class="text-center mb-4">
                <p class="text-sm font-semibold text-gray-500">ç›®æ¨™é‡‘é¡</p>
                <p id="targetAmount" class="text-4xl font-extrabold text-purple-700">Â¥60,000</p>
            </div>
            <div class="text-center mb-4">
                <p class="text-sm font-semibold text-gray-500">ç¾åœ¨ã®è²¯é‡‘é¡</p>
                <p id="currentAmount" class="text-5xl font-extrabold text-purple-800">Â¥0</p>
            </div>
            
            <!-- é€²æ—ãƒãƒ¼ -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden">
                <div id="progressBar" class="bg-purple-500 h-4 rounded-full transition-all duration-500" style="width: 0%;"></div>
            </div>
            <p id="progressText" class="text-center text-lg font-bold text-purple-700">é”æˆç‡: 0%</p>
        </div>

        <!-- è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div id="inputView" class="space-y-4">
            <h2 class="text-xl font-bold text-center text-gray-700">ä»Šæ—¥ã®è²¯é‡‘ã‚’è¨˜éŒ²</h2>
            
            <!-- èª°ãŒè²¯é‡‘ã—ãŸã‹ã‚’é¸æŠ -->
            <div class="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg">
                <span class="text-2xl">ğŸ‘¤</span>
                <select id="saverName" class="flex-grow p-2 rounded-md border border-gray-300 bg-white">
                    <option value="ãŠçˆ¶ã•ã‚“">ãŠçˆ¶ã•ã‚“</option>
                    <option value="ãŠæ¯ã•ã‚“">ãŠæ¯ã•ã‚“</option>
                    <option value="å…‹æ¨¹">å…‹æ¨¹</option>
                    <option value="æ¥“">æ¥“</option>
                </select>
            </div>

            <!-- ç©ç«‹è²¯é‡‘ -->
            <div class="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg">
                <span class="text-2xl">ğŸ’°</span>
                <input type="number" id="dailySavings" placeholder="ç©ç«‹è²¯é‡‘é¡ (ä¾‹: 200)" class="flex-grow p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <button onclick="addSavings('dailySavings')" class="bg-purple-500 text-white p-2 rounded-md hover:bg-purple-600 transition">è¿½åŠ </button>
            </div>
            
            <!-- ãŠæ‰‹ä¼ã„å ±å¥¨ -->
            <div class="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg">
                <span class="text-2xl">ğŸ¤</span>
                <input type="number" id="choreReward" placeholder="ãŠæ‰‹ä¼ã„å ±å¥¨é‡‘ (ä¾‹: 100)" class="flex-grow p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <button onclick="addSavings('choreReward')" class="bg-purple-500 text-white p-2 rounded-md hover:bg-purple-600 transition">è¿½åŠ </button>
            </div>
            
            <h3 class="text-lg font-bold text-center text-gray-600 mt-6">è‡¨æ™‚åå…¥</h3>
            
            <!-- è‡¨æ™‚åå…¥ -->
            <div class="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg">
                <span class="text-2xl">ğŸ</span>
                <select id="extraSource" class="p-2 rounded-md border border-gray-300 bg-white">
                    <option value="mercari">ãƒ¡ãƒ«ã‚«ãƒªå£²ä¸Š</option>
                    <option value="foodSavings">å¤§äººã®é£Ÿè²»ç¯€ç´„</option>
                    <option value="christmas">ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ</option>
                    <option value="other">ãã®ä»–</option>
                </select>
                <input type="number" id="extraSavings" placeholder="é‡‘é¡ (ä¾‹: 1500)" class="flex-grow p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <button onclick="addExtraSavings()" class="bg-purple-500 text-white p-2 rounded-md hover:bg-purple-600 transition">è¿½åŠ </button>
            </div>
        </div>
        
        <!-- å±¥æ­´è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="historyView" class="mt-8">
            <h2 class="text-xl font-bold text-center text-gray-700 mb-4">è²¯é‡‘ã®å±¥æ­´</h2>
            <ul id="historyList" class="bg-gray-50 p-4 rounded-xl space-y-2 max-h-60 overflow-y-auto">
                <!-- å±¥æ­´ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </ul>
        </div>

        <!-- ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢ (éè¡¨ç¤ºã‹ã‚‰é–‹å§‹) -->
        <div id="graphView" class="mt-8 hidden">
            <h2 class="text-xl font-bold text-center text-gray-700 mb-4">æœˆåˆ¥è²¯é‡‘ãƒšãƒ¼ã‚¹</h2>
            <div class="relative h-64">
                <canvas id="savingsChart"></canvas>
            </div>
        </div>
        
        <!-- å€‹äººåˆ¥è²¢çŒ®åº¦è¡¨ç¤ºã‚¨ãƒªã‚¢ (éè¡¨ç¤ºã‹ã‚‰é–‹å§‹) -->
        <div id="individualContributionView" class="mt-8 hidden">
            <h2 class="text-xl font-bold text-center text-gray-700 mb-4">å€‹äººåˆ¥è²¢çŒ®åº¦</h2>
            <ul id="individualContributionList" class="bg-gray-50 p-4 rounded-xl space-y-2">
                <!-- å€‹äººåˆ¥ã®è²¢çŒ®åº¦ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </ul>
        </div>
    </div>

    <script>
        // ç›®æ¨™é‡‘é¡ã®è¨­å®š
        const TARGET_AMOUNT = 60000;
        const TARGET_MONTHS = 12; // 12ãƒ¶æœˆ
        const START_DATE = new Date(2025, 7, 1); // 2025å¹´8æœˆã‹ã‚‰é–‹å§‹ (æœˆã¯0-11)
        const SAVER_NAMES = ["ãŠçˆ¶ã•ã‚“", "ãŠæ¯ã•ã‚“", "å…‹æ¨¹", "æ¥“"];
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        window.savingsData = [];
        window.currentTotal = 0;
        let savingsChart;

        // è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        window.updateDisplay = function() {
            // ç¾åœ¨ã®è²¯é‡‘é¡ã‚’æ›´æ–°
            document.getElementById('currentAmount').textContent = `Â¥${window.currentTotal.toLocaleString()}`;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–°
            const progress = (window.currentTotal / TARGET_AMOUNT) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('progressText').textContent = `é”æˆç‡: ${Math.min(progress, 100).toFixed(1)}%`;
        };

        // å±¥æ­´ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
        window.renderHistory = function() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            window.savingsData.slice().reverse().forEach((item) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-white p-3 rounded-md shadow-sm';
                
                // ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                const actionsHtml = `
                    <div class="flex space-x-2">
                        <button onclick="editEntry('${item.id}')" class="bg-blue-500 text-white text-xs p-1 rounded hover:bg-blue-600 transition">ç·¨é›†</button>
                        <button onclick="deleteEntry('${item.id}')" class="bg-red-500 text-white text-xs p-1 rounded hover:bg-red-600 transition">å‰Šé™¤</button>
                    </div>
                `;

                li.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-xl">${getIcon(item.type)}</span>
                        <div>
                            <p class="font-bold">${item.source} <span class="font-normal text-gray-500">by ${item.person || 'ä¸æ˜'}</span></p>
                            <p class="text-sm text-gray-500">${new Date(item.date).toLocaleDateString('ja-JP')}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-extrabold text-purple-600">Â¥${item.amount.toLocaleString()}</span>
                        ${actionsHtml}
                    </div>
                `;
                historyList.appendChild(li);
            });
        };
        
        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function getIcon(type) {
            switch (type) {
                case 'dailySavings': return 'ğŸ’°';
                case 'choreReward': return 'ğŸ¤';
                case 'mercari': return 'ğŸ';
                case 'foodSavings': return 'ğŸ¥—';
                case 'christmas': return 'ğŸ„';
                case 'other': return 'ğŸ“¦';
                default: return 'âœ…';
            }
        }

        // ã‚·ãƒ³ãƒ—ãƒ«ãªé€šçŸ¥æ©Ÿèƒ½ï¼ˆ`alert`ã®ä»£ã‚ã‚Šã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºï¼‰
        window.showNotification = function(message, type) {
            console.log(`Notification (${type}): ${message}`);
        };

        // æœˆåˆ¥è²¯é‡‘é¡ã‚’è¨ˆç®—ã—ã€ã‚°ãƒ©ãƒ•ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
        window.renderChart = function() {
            const ctx = document.getElementById('savingsChart').getContext('2d');
            if (savingsChart) {
                savingsChart.destroy(); // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            }

            const monthlySavings = {};
            const monthlyLabels = [];
            const targetDate = new Date(START_DATE);
            targetDate.setMonth(targetDate.getMonth() + TARGET_MONTHS);
            
            let currentDate = new Date(START_DATE);
            while (currentDate < targetDate) {
                const yearMonth = currentDate.getFullYear() + '-' + (currentDate.getMonth() + 1).toString().padStart(2, '0');
                monthlyLabels.push(`${currentDate.getFullYear()}å¹´${currentDate.getMonth() + 1}æœˆ`);
                monthlySavings[yearMonth] = 0;
                currentDate.setMonth(currentDate.getMonth() + 1);
            }

            window.savingsData.forEach(item => {
                const date = new Date(item.date);
                const yearMonth = date.getFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, '0');
                if (monthlySavings[yearMonth] !== undefined) {
                    monthlySavings[yearMonth] += item.amount;
                }
            });

            const cumulativeSavings = [];
            const targetPace = [];
            let cumulativeAmount = 0;
            for (let i = 0; i < monthlyLabels.length; i++) {
                const yearMonth = new Date(START_DATE.getFullYear(), START_DATE.getMonth() + i).getFullYear() + '-' + (new Date(START_DATE.getFullYear(), START_DATE.getMonth() + i).getMonth() + 1).toString().padStart(2, '0');
                cumulativeAmount += monthlySavings[yearMonth] || 0;
                cumulativeSavings.push(cumulativeAmount);
                targetPace.push((TARGET_AMOUNT / TARGET_MONTHS) * (i + 1));
            }

            savingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthlyLabels,
                    datasets: [{
                        label: 'å®Ÿéš›ã®è²¯é‡‘é¡',
                        data: cumulativeSavings,
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'ç›®æ¨™è²¯é‡‘ãƒšãƒ¼ã‚¹',
                        data: targetPace,
                        borderColor: '#9CA3AF',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'è²¯é‡‘é¡ (å††)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'æœˆåˆ¥è²¯é‡‘æ¨ç§»ã¨ç›®æ¨™ãƒšãƒ¼ã‚¹',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        };
        
        // å€‹äººåˆ¥ã®è²¢çŒ®åº¦ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        window.renderIndividualContributions = function() {
            const contributionList = document.getElementById('individualContributionList');
            contributionList.innerHTML = '';
            
            // å„å€‹äººã®è²¢çŒ®åº¦ã‚’è¨ˆç®—
            const contributions = SAVER_NAMES.reduce((acc, name) => ({ ...acc, [name]: 0 }), {});
            window.savingsData.forEach(item => {
                if (contributions[item.person] !== undefined) {
                    contributions[item.person] += item.amount;
                }
            });

            // è²¢çŒ®åº¦ã‚’ãƒªã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤º
            SAVER_NAMES.forEach(name => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-white p-3 rounded-md shadow-sm';
                li.innerHTML = `
                    <p class="font-bold text-gray-700">${name}</p>
                    <span class="font-extrabold text-purple-600">Â¥${contributions[name].toLocaleString()}</span>
                `;
                contributionList.appendChild(li);
            });
        };
        
        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        window.setupViewButtons = function() {
            const inputView = document.getElementById('inputView');
            const historyView = document.getElementById('historyView');
            const graphView = document.getElementById('graphView');
            const individualContributionView = document.getElementById('individualContributionView'); // æ–°ã—ã„ãƒ“ãƒ¥ãƒ¼
            
            const viewInputButton = document.getElementById('viewInputButton');
            const viewGraphButton = document.getElementById('viewGraphButton');
            const viewContributionButton = document.getElementById('viewContributionButton'); // æ–°ã—ã„ãƒœã‚¿ãƒ³

            viewInputButton.addEventListener('click', () => {
                inputView.classList.remove('hidden');
                historyView.classList.remove('hidden');
                graphView.classList.add('hidden');
                individualContributionView.classList.add('hidden');
                
                viewInputButton.classList.remove('bg-gray-200', 'text-gray-700');
                viewInputButton.classList.add('bg-purple-500', 'text-white');
                viewGraphButton.classList.remove('bg-purple-500', 'text-white');
                viewGraphButton.classList.add('bg-gray-200', 'text-gray-700');
                viewContributionButton.classList.remove('bg-purple-500', 'text-white');
                viewContributionButton.classList.add('bg-gray-200', 'text-gray-700');
            });

            viewGraphButton.addEventListener('click', () => {
                inputView.classList.add('hidden');
                historyView.classList.add('hidden');
                graphView.classList.remove('hidden');
                individualContributionView.classList.add('hidden');
                
                viewGraphButton.classList.remove('bg-gray-200', 'text-gray-700');
                viewGraphButton.classList.add('bg-purple-500', 'text-white');
                viewInputButton.classList.remove('bg-purple-500', 'text-white');
                viewInputButton.classList.add('bg-gray-200', 'text-gray-700');
                viewContributionButton.classList.remove('bg-purple-500', 'text-white');
                viewContributionButton.classList.add('bg-gray-200', 'text-gray-700');
                
                window.renderChart();
            });
            
            viewContributionButton.addEventListener('click', () => {
                inputView.classList.add('hidden');
                historyView.classList.add('hidden');
                graphView.classList.add('hidden');
                individualContributionView.classList.remove('hidden');
                
                viewContributionButton.classList.remove('bg-gray-200', 'text-gray-700');
                viewContributionButton.classList.add('bg-purple-500', 'text-white');
                viewInputButton.classList.remove('bg-purple-500', 'text-white');
                viewInputButton.classList.add('bg-gray-200', 'text-gray-700');
                viewGraphButton.classList.remove('bg-purple-500', 'text-white');
                viewGraphButton.classList.add('bg-gray-200', 'text-gray-700');
                
                window.renderIndividualContributions(); // å†åº¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦æœ€æ–°ã®æƒ…å ±ã‚’è¡¨ç¤º
            });
        };

        // `confirm()`ã¨`prompt()`ã®ä»£ã‚ã‚Šã«ã‚«ã‚¹ã‚¿ãƒ UIã‚’ä½œæˆ
        window.confirm = (message) => {
            return window.prompt(message, 'yes').toLowerCase() === 'yes';
        };
    </script>
</body>
</html>
